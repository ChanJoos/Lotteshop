<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fis.board.notice.dao.NoticeDAO">
	<cache />
	<!-- <![CDATA[ ]]> -->



	<insert id="insertNotice">

		DECLARE @DATE VARCHAR(8)
		DECLARE @TITLE VARCHAR(100)
		DECLARE @CONTENTS
		VARCHAR(1000)
		DECLARE @CREATOR VARCHAR(20)

		SET @DATE =
		CONVERT(VARCHAR(8),getdate(),112)
		SET @TITLE = #{title}
		SET @CONTENTS =
		#{contents}
		SET @CREATOR = #{user_name}

		INSERT INTO FIS_NOTICE_TB
		(DATE,TITLE,CONTENTS,CREATOR,CREATE_DATE,UPDATE_DATE)
		VALUES(@DATE,@TITLE,@CONTENTS,@CREATOR,getdate(),getdate())
	</insert>
	<update id="updateNotice">

		DECLARE @NUM int
		DECLARE @TITLE VARCHAR(100)
		DECLARE
		@CONTENTS VARCHAR(1000)

		SET @NUM = #{num}
		SET @TITLE = #{title}
		SET
		@CONTENTS = #{contents}

		UPDATE
		FIS_NOTICE_TB SET TITLE = @TITLE,
		CONTENTS = @CONTENTS,
		UPDATE_DATE =
		getdate() WHERE NUM = @NUM
	</update>


	<delete id="deleteNotice">

		DECLARE @NUM int

		SET @NUM = #{num}
		DELETE FROM
		FIS_NOTICE_TB WHERE NUM = @NUM
	</delete>

	<delete id="deleteCommentsBelongNotice">

		DECLARE @CONTENTS_NUM int

		SET @CONTENTS_NUM =
		#{contents_num}

		DELETE FROM
		FIS_NOTICE_COMMENTS_TB
		WHERE CONTENTS_NUM =
		@CONTENTS_NUM
	</delete>

	<select id="getOneComment" parameterType="CommentVO" resultType="baseMap">

		DECLARE @NUM int

		SET @NUM =#{num}

		SELECT NUM,CREATOR
		FROM
		FIS_NOTICE_COMMENTS_TB
		WHERE NUM = @NUM

	</select>
	<delete id="deleteComment">

		DECLARE @NUM int

		SET @NUM =#{num}

		DELETE FROM
		FIS_NOTICE_COMMENTS_TB
		WHERE NUM = @NUM
	</delete>


	<insert id="insertComment">

		DECLARE @CONTENTS_NUM int
		DECLARE @DATE VARCHAR(8)
		DECLARE @CONTENTS VARCHAR(1000)
		DECLARE @CREATOR VARCHAR(20)

		SET @DATE =
		CONVERT(VARCHAR(8),getdate(),112)
		SET @CONTENTS_NUM = #{contents_num}
		SET @CONTENTS = #{contents}
		SET @CREATOR = #{creator}

		INSERT INTO
		FIS_NOTICE_COMMENTS_TB
		(CONTENTS_NUM,DATE,CONTENTS,CREATOR,CREATE_DATE,UPDATE_DATE)
		VALUES(@CONTENTS_NUM,@DATE,@CONTENTS,@CREATOR,getdate(),getdate())
	</insert>

	<select id="getComments" parameterType="CommentVO" resultType="baseMap">
		DECLARE @CONTENTS_NUM INT

		SET @CONTENTS_NUM = #{contents_num}

		SELECT
		NUM, CREATOR, CREATOR AUTH, CONTENTS , left(DATE,4) + '/' +
		right(left(DATE,6),2) +
		'/'+ right(DATE,2) DATE
		FROM
		FIS_NOTICE_COMMENTS_TB
		WHERE CONTENTS_NUM = @CONTENTS_NUM

	</select>

	<select id="showList" parameterType="BoardVO" resultType="baseMap">
		SELECT
		ROW_NUMBER() OVER (order by NUM) ROW_NUM,NUM,TITLE,CREATOR,
		(left(DATE,4) +
		'/' + right(left(DATE,6),2) + '/'
		+ right(DATE,2)) DATE
		FROM
		FIS_NOTICE_TB
		ORDER BY NUM DESC
	</select>

	<select id="searchList" parameterType="BoardVO" resultType="baseMap">
		DECLARE @WORD VARCHAR(100)

		SET @WORD = #{searchWord}

		SELECT ROW_NUMBER()
		OVER (order by NUM) ROW_NUM,NUM,TITLE,CREATOR, (left(DATE,4) + '/' +
		right(left(DATE,6),2) + '/'
		+ right(DATE,2)) DATE
		FROM FIS_NOTICE_TB
		WHERE TITLE like '%' + @WORD + '%' OR CONTENTS like '%' + @WORD + '%'
		ORDER BY NUM DESC
	</select>

	<select id="showContents" parameterType="BoardVO" resultType="baseMap">
		SELECT TITLE,CONTENTS,CREATOR,left(DATE,4) + '/' +
		right(left(DATE,6),2) + '/' + right(DATE,2) DATE
		FROM FIS_NOTICE_TB
		WHERE NUM = #{num}
	</select>

</mapper>